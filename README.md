## Проект - тестовое задание "amocrm_python_test"

Проект представляет собой backend часть приложения, собирающего с внешнего эндпоинта метрики по машинам
и поиску среди них инцидентов - превышений среднего значения CPU, memory или disk за n-записей.

## Содержание
- [Технологии](#технологии)
- [WorkResults](#workresults)
- [Эндпоинты](#эндпоинты)
- [LocalAccess](#localaccess)
- [ProjectCommander](#ProjectCommander)

## Технологии
- Python: версия 3.12
- Django: версия 5
- MySQL: версия 8
- Docker
- Redis
- Celery


## WorkResults
1) Реализация задачи №1
   - Сбор метрик осуществляется с внешнего эндпоинта (https://forsanya.onrender.com/metrics).
   - Celery таска get_and_save_metric осуществляет запросы к эндпоинту каждые 15 минут.
   - Получаемые данные валидируются через сериализатор, добавляются в промежуточный список и после - пакетно отправляются в таблицу MetricStorage.
   
2) Реализация задачи №2
   - К изначальному формату данных я добавил поле machine_ip - именно по нему метрики из MetricStorage и будут фильтроваться.
   - В проекте есть три задачи, одна уже была описана выше, и она через chain связана с группой задач - с check_cpu_and_mem и check_disk
     (чтобы анализ данных осуществлялся только после записи актуальных).
   - Таски check_cpu_and_mem и check_disk выполняют запросы к БД и для каждой из машин получают n-ое количество записей
     (где n - это 3 для check_cpu_and_mem и 9 для check_disk, что является диапазоном в 30 и 120 минут соответственно)
   - Если среднее знчение для n записей превышает указанный трешхолд - создаётся инцидент в таблице Incident.
     
3) Проект контейнеризирован на Docker
4) Описан README.md с информацией о проекте, инструкцией по запуску.


## Эндпоинты
Получение списка инцидентов напрямую:
```
Метод GET
     
url: /api/incdents/
```
Также информацию по инцидентам можно получить из интерактивной документации swagger:
``` 
url: /docs/
```

В проекте также происходит взаимодействие с внешним эндпоинтом - https://forsanya.onrender.com/metrics.
Он представляет собой поднятый на render.com Node.JS скрипт, генерирующий 30 рандомных записей при каждом обращении.


## LocalAccess
Для запуска проекта локально:
1) Клонируйте репозиторий командой:
   ```
   git clone https://github.com/Acetonerer/amocrm_python_test
   ```
2) Создайте и активируйте виртуальное окружение командами:
   ```
   python -m venv venv

   venv\Scripts\activate
   ```
3) Установите зависимости командой:
   ```
   pip install -r requirements.txt
   ```
4) Создайте и заполните .env согласно образцу .env.sample

5) Соберите Docker образ и запустите командой:
   ```
   docker-compose up --build
   ```
6) Для получения информации об обнаруженных инцидентах перейдите по адресу из контейнера backend_amocrm либо:
   ```
   http://localhost:8000/api/incidents/
   ```

## ProjectCommander
Александр Болокан - backend developer
